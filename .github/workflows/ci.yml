name: Template Validation

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  validate-structure:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Validate Template Structure
      run: |
        echo "Checking required directories..."
        test -d "CLIENT_TEMPLATE" && echo "✓ CLIENT_TEMPLATE exists" || exit 1
        test -d "CLIENT_TEMPLATE/_context" && echo "✓ _context exists" || exit 1
        test -d "CLIENT_TEMPLATE/discovery" && echo "✓ discovery exists" || exit 1
        test -d "CLIENT_TEMPLATE/roadmap" && echo "✓ roadmap exists" || exit 1
        test -d "CLIENT_TEMPLATE/sow_projects" && echo "✓ sow_projects exists" || exit 1
        
    - name: Check Required Files
      run: |
        echo "Checking required files..."
        test -f "README.md" && echo "✓ README.md exists" || exit 1
        test -f "LICENSE" && echo "✓ LICENSE exists" || exit 1
        test -f ".gitignore" && echo "✓ .gitignore exists" || exit 1
        test -f "CLIENT_TEMPLATE/README.md" && echo "✓ CLIENT_TEMPLATE/README.md exists" || exit 1
        
    - name: Validate Markdown Files
      run: |
        echo "Checking for broken markdown files..."
        find . -name "*.md" -type f -exec file {} \; | grep -E "ASCII|UTF-8" > /dev/null || echo "Warning: Some markdown files may have encoding issues"
        
    - name: Check File Sizes
      run: |
        echo "Checking for oversized files..."
        find . -type f -size +10M -exec ls -lh {} \; | awk '{print "Warning: Large file detected: " $9 " (" $5 ")"}'
